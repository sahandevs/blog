<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link href="https://fonts.googleapis.com/css?family=Source Code Pro" rel="stylesheet"/><style data-href="/styles.87b71533585f5c7ef3aa.css" data-identity="gatsby-global-css">:root{--lr-padding:18%;--border-radius:8px;--primary-color-active:#ff7e14;--primary-color-inactive:#ffd1ac;--secondary-color:#fffcf9;--anim-duration:300ms;font-size:20px}.footnotes,.main-container h1,.text,a,em,h2,h3,h4,h5,h6,li,p,ul{direction:rtl;font-family:Vazir,monospace,Source Code Pro!important;line-height:1.6}.text a{overflow-wrap:anywhere}.footnotes li{color:#5c6e74;font-size:.8rem}.main-container p{margin:0}a{text-decoration:none}a,a:hover{color:var(--primary-color-active)}a:hover{text-decoration:underline}.main-container{padding-left:var(--lr-padding);padding-right:var(--lr-padding);padding-top:1rem}.main-container img{display:block;margin-left:auto;margin-right:auto;max-height:500px;max-width:100%}.main-container .img-container{max-width:100%}@media screen and (max-width:768px){:root{--lr-padding:10%}}@media screen and (max-width:375px){:root{--lr-padding:5%}.main-container blockquote{margin:25px 0 0}.main-container img{max-width:170%;vertical-align:top}.main-container .img-container{overflow-x:auto}}.main-container p,.text{text-align:justify}.main-container blockquote .text{--h-space:10px;--v-space:4px;background-color:#e7e7e7;border-radius:var(--border-radius);border-right:5px solid var(--primary-color-inactive);margin:25px calc(var(--h-space)*3) 30px calc(var(--h-space)*3);padding:var(--v-space) var(--h-space);transition:border-right var(--anim-duration)}.main-container blockquote .text:hover{border-right-color:var(--primary-color-active)}.resources .text{direction:ltr}.main-container code{background-color:#f1f1f1;border-radius:var(--border-radius);direction:ltr!important;padding-left:6px;padding-right:6px}.playground-button{background-color:var(--primary-color-active);border-bottom-left-radius:var(--border-radius);padding:0 5px;position:absolute;right:0;top:0}.playground-button a{color:#fff;font-size:.8rem;margin:0}.playground-button a:hover{text-decoration:none}code[class*=language-],pre[class*=language-]{color:#5c6e74;direction:ltr;font-family:Source Code Pro,Andale Mono,Ubuntu Mono,monospace;font-size:1rem;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;text-align:left;text-shadow:none;white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-]::mozselection,code[class*=language-]::selection,pre[class*=language-]::mozselection,pre[class*=language-]::selection{background:#b3d4fc;text-shadow:none}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{background:var(--secondary-color);border:1px solid var(--primary-color-inactive);border-radius:var(--border-radius);margin:.5em 0;overflow:auto;padding:.8em;transition:border var(--anim-duration)}pre[class*=language-]:hover{border:1px solid var(--primary-color-active)}:not(pre)>code[class*=language-]{background:#f9f2f4;border-radius:.3em;color:#db4c69;padding:.1em .3em}.namespace{opacity:.7}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#93a1a1}.token.punctuation{color:#999}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{background:#fff;color:#a67f59}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}pre[data-line]{position:relative}pre[class*=language-]>code[class*=language-]{position:relative;z-index:1}.line-highlight{background:#f7ebc6;box-shadow:inset 5px 0 0 #f7d87c;left:0;line-height:inherit;margin-top:1em;padding-bottom:inherit;padding-left:0;padding-right:0;padding-top:inherit;pointer-events:none;position:absolute;right:0;white-space:pre;z-index:0}</style><meta name="generator" content="Gatsby 4.1.3"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><title data-react-helmet="true">ฺุงูุด ูุง ูพุงุฏู ุณุงุฒ ratelimiter ุจุฑุง ฺฉ CDN - ูุณูุช ฒ</title><meta data-react-helmet="true" charSet="utf-8"/><meta data-react-helmet="true" property="og:title" content="ฺุงูุด ูุง ูพุงุฏู ุณุงุฒ ratelimiter ุจุฑุง ฺฉ CDN - ูุณูุช ฒ"/><meta data-react-helmet="true" property="og:site_name" content="Sahand&#x27;s blog"/><link rel="sitemap" type="application/xml" href="/sitemap/sitemap-index.xml"/><link as="script" rel="preload" href="/webpack-runtime-0d9786d76e01cb556047.js"/><link as="script" rel="preload" href="/framework-02d188296aa8e09a771c.js"/><link as="script" rel="preload" href="/app-6065ccb4df465e7f2f5d.js"/><link as="script" rel="preload" href="/5e999c8c245179cb3a2ef9e4a39c885397d99ba6-cda9dcdd44aeb28b65a8.js"/><link as="script" rel="preload" href="/component---src-pages-ratelimit-p-2-mdx-d396b307766e78b1a114.js"/><link as="fetch" rel="preload" href="/page-data/ratelimit-p2/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="main-container"><div class="text">๐ง๐ง๐ง๐ง๐ง๐ง๐ง๐ง๐ง๐ง๐ง๐ง๐ง๐ง๐งุฏุฑ ุฏุณุช ูฺฏุงุฑุด๐ง๐ง๐ง๐ง๐ง๐ง๐ง๐ง๐ง๐ง๐ง๐ง๐ง๐ง๐ง</div><h1>ฺุงูุด ูุง ูพุงุฏู ุณุงุฒ ratelimiter ุจุฑุง ฺฉ CDN - ูุณูุช ฒ</h1><blockquote><div class="text">ุงู ูุทูุจ ุงุฏุงูู
<a href="/ratelimit-p1" dir="ltr">ูุณูุช ฑ</a> ุณุฑ
ยซฺุงูุด ูุง ูพุงุฏู ุณุงุฒ ratelimiter ุจุฑุง CDNยป
ูุณุช ู ูุฑุถ ูโฺฉูู ฺฉู ุดูุง
ูุจูุง ุงูู ุฑู ูุทุงูุนู ฺฉุฑุฏุฏ.</div></blockquote><div class="text">ููู ูุจโุณุฑูุฑ ูุง ุงู ูุงุจูุช ุฑู ุฏุงุฑู ฺฉู ุชุนุฏุงุฏ ุฒุงุฏ ุงุฒ ุฏุฑุฎูุงุณุช ูุงุฑู ููุฒูุงู ุจุง ูู ูุจูู ฺฉูู. ุจุง
thread, async
ุง ุญุช ุจุง ุงุณุชูุงุฏู ุงุฒ
sub-process. ุงฺฏุฑ ฺฉ ููุฑ ฺูุฏ ุฏุฑุฎูุงุณุช ููุฒูุงู ุงุฑุณุงู ฺฉููุ ุณุฑูุฑ ฺุทูุฑ
ratelimit
ุงููู ุญุณุงุจ ูโฺฉููุ ุชู ุงู ูุณูุช ุจู ุงู ููุถูุน ูฺฏุงู ูโฺฉูู.</div><h2>ุงุดุชุฑุงฺฉ ููุงุจุน</h2><div class="text">ุชูุฑุจุง ูุฑ ูููุน ฺฉู
concurrency ุฏุงุฑู
ุ ุจุงุฏ ุจู ุงู ูฺฉุฑ ฺฉูู ฺฉู
ููุงุจุน ููุฒูุงู ฺุทูุฑ ูุชููู ุฏุณุช ฺูุฏ ฺุฒ (ูุซู thread)
ุจุงุดู. ุชู ูุณุฆูู ูุงุ ฺููฺฉู ููฺฉูู ูุจ ุณุฑูุฑููู ุฏุฑุฎูุงุณุช ูุง ูุฎุชูู ฺฉ ููุฑ ุฑู ุจุง ุชุฑุฏ ูุง ูุฎุชูู ููุฏู ฺฉููุ
ู ูุง ุจุงุฏ ุดูุงุฑูุฏู ูุง ุงูฺฏูุฑุชูููู ุจู ุงู ุชุฑุฏ ูุง ูุดุชุฑฺฉ ุจุงุดูุ ูุง ูู ุงู ูุณุฆูู ุฑู ุฏุงุฑู ู ุจุงุฏ ฺฉ ุฑุงู ุญู ุจุฑุงุด
ุฏุฑ ูุธุฑ ุจฺฏุฑู.</div><h3>Mutex</h3><div class="text">ุจุงู ุงูู ุงุฒ
<a href="https://en.wikipedia.org/wiki/Lock_(computer_science)" dir="ltr">Mutex Lock</a>
ุงุณุชูุงุฏู ฺฉูู ฺฉู ุฑุงูโุญู ุณุงุฏูโุง ุฑู ุจู ูุง ูโุฏู ุชุง ุจุชููู ุงููุช ุงู ููุถูุน ุฑู ุฏุฑฺฉ ฺฉูู.</div><div class="text">ุจุฑุง ุณุงุฏฺฏ ููุถูุนุโ ุฏุฑ ูุธุฑ ุจฺฏุฑู ฺฉ ูุจโุณุฑูุฑ ุฏุงุฑู ฺฉู ุนุฏุฏ ฑ ุชุง ฑฐฐฐ ุฑู ุจุงุฏ ุจุง ูู ุฌูุน ฺฉูู
ู ููุช ุฏุงุฑู ุงูฺฉุงุฑู ูโฺฉููุโ ุชุฑุฏ ูุง ุฏฺฏู ุจุงุฏ ููุชุธุฑ ุงู ฺฉุงุฑ ุจุงุดู.</div><div style="position:relative"><div class="playground-button"><a target="_blank" href="https://play.rust-lang.org/?edition=2021&amp;code=use%20parking_lot%3A%3AMutex%3B%0Ause%20std%3A%3Async%3A%3Ampsc%3A%3A%7Bself%2C%20Sender%7D%3B%0Ause%20std%3A%3Async%3A%3AArc%3B%0Ause%20std%3A%3Athread%3A%3AJoinHandle%3B%0Ause%20std%3A%3Atime%3A%3AInstant%3B%0A%0A%0A%23%5Binline(never)%5D%0A%23%5Bcold%5D%0Afn%20do_work(lock%3A%20%26Arc%3CMutex%3C()%3E%3E%2C%20no_lock%3A%20bool)%20-%3E%20usize%20%7B%0A%20%20%20%20let%20_lock_guard%3B%0A%20%20%20%20if%20!no_lock%20%7B%0A%20%20%20%20%20%20%20%20_lock_guard%20%3D%20lock.lock()%3B%0A%20%20%20%20%7D%0A%20%20%20%20let%20mut%20result%20%3D%200%3B%0A%20%20%20%20for%20i%20in%201..%3D1000%20%7B%0A%20%20%20%20%20%20%20%20result%20%2B%3D%20i%3B%0A%20%20%20%20%7D%0A%20%20%20%20result%0A%7D%0A%0Apub%20struct%20WebServer%20%7B%0A%20%20%20%20threads%3A%20Vec%3C(usize%2C%20Sender%3C()%3E%2C%20JoinHandle%3Cusize%3E)%3E%2C%0A%7D%0A%0Aimpl%20WebServer%20%7B%0A%20%20%20%20pub%20fn%20new(num_threads%3A%20usize%2C%20no_lock%3A%20bool)%20-%3E%20Self%20%7B%0A%20%20%20%20%20%20%20%20let%20lock%20%3D%20Arc%3A%3Anew(Mutex%3A%3Anew(()))%3B%0A%20%20%20%20%20%20%20%20let%20threads%3A%20Vec%3C_%3E%20%3D%20(1..%3Dnum_threads)%0A%20%20%20%20%20%20%20%20%20%20%20%20.map(%7Ci%7C%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20(tx%2C%20rx)%20%3D%20mpsc%3A%3Achannel%3A%3A%3C()%3E()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20lock%20%3D%20Arc%3A%3Aclone(%26lock)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20handle%20%3D%20std%3A%3Athread%3A%3Aspawn(move%20%7C%7C%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20lock%20%3D%20lock%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20let%20mut%20total%20%3D%200%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20while%20let%20Ok(_)%20%3D%20rx.recv()%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20total%20%2B%3D%20do_work(%26lock%2C%20no_lock)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20total%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(i%2C%20tx%2C%20handle)%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D)%0A%20%20%20%20%20%20%20%20%20%20%20%20.collect()%3B%0A%20%20%20%20%20%20%20%20WebServer%20%7B%20threads%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20pub%20fn%20send_work(%26self%2C%20num_works%3A%20usize)%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F%20--snip--%0A%20%20%20%20%20%20%20%20self.threads%0A%20%20%20%20%20%20%20%20%20%20%20%20.iter()%0A%20%20%20%20%20%20%20%20%20%20%20%20.map(%7Cx%7C%20x.1.clone())%0A%20%20%20%20%20%20%20%20%20%20%20%20.map(%7Cx%7C%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20std%3A%3Athread%3A%3Aspawn(move%20%7C%7C%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20_%20in%201..%3Dnum_works%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20x.send(()).unwrap()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20It&#x27;s%20important%20to%20first%20collect%20all%2C%20then%20join%20the%20threads.%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20We%20want%20all%20the%20sender%20threads%20to%20start%20together.%0A%20%20%20%20%20%20%20%20%20%20%20%20.collect%3A%3A%3CVec%3C_%3E%3E()%0A%20%20%20%20%20%20%20%20%20%20%20%20.into_iter()%0A%20%20%20%20%20%20%20%20%20%20%20%20.for_each(%7Cx%7C%20x.join().unwrap())%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20pub%20fn%20shutdown(mut%20self)%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F%20--snip--%0A%20%20%20%20%20%20%20%20while%20let%20Some((i%2C%20sender%2C%20handle))%20%3D%20self.threads.pop()%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20drop(sender)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20let%20result%20%3D%20handle.join().unwrap()%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20println!(%22%5B%7B%7D%5D%20total%20%3D%20%7B%7D%22%2C%20i%2C%20result)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%7D%0A%0Aconst%20JOBS%3A%20usize%20%3D%201_000_000%3B%0A%0A%23%5Binline(never)%5D%0A%23%5Bno_mangle%5D%0Afn%20with_lock()%20%7B%0A%20%20%20%20let%20server_with_lock%20%3D%20WebServer%3A%3Anew(16%2C%20false)%3B%0A%0A%20%20%20%20let%20now%20%3D%20Instant%3A%3Anow()%3B%0A%20%20%20%20server_with_lock.send_work(JOBS)%3B%0A%20%20%20%20server_with_lock.shutdown()%3B%0A%20%20%20%20println!(%22with%20lock%20took%20%7B%3A%3F%7D%22%2C%20now.elapsed())%3B%0A%7D%0A%0A%23%5Binline(never)%5D%0A%23%5Bno_mangle%5D%0Afn%20without_lock()%20%7B%0A%20%20%20%20let%20server_without_lock%20%3D%20WebServer%3A%3Anew(16%2C%20true)%3B%0A%20%20%20%20let%20now%20%3D%20Instant%3A%3Anow()%3B%0A%20%20%20%20server_without_lock.send_work(JOBS)%3B%0A%20%20%20%20server_without_lock.shutdown()%3B%0A%20%20%20%20println!(%22without%20lock%20took%20%7B%3A%3F%7D%22%2C%20now.elapsed())%3B%0A%7D%0A%0Afn%20main()%20%7B%0A%20%20%20%20with_lock()%3B%0A%20%20%20%20without_lock()%3B%0A%7D">Rust Playground</a></div><pre class="prism-code language-rust"><div class="token-line"><span class="token plain">fn do_work(lock: &amp;Arc&lt;Mutex&lt;()&gt;&gt;, no_lock: bool) -&gt; usize {</span></div><div class="token-line"><span class="token plain">    let _lock_guard;</span></div><div class="token-line"><span class="token plain">    if !no_lock {</span></div><div class="token-line"><span class="token plain">        _lock_guard = lock.lock();</span></div><div class="token-line"><span class="token plain">    }</span></div><div class="token-line"><span class="token plain">    let mut result = 0;</span></div><div class="token-line"><span class="token plain">    for i in 1..=1000 {</span></div><div class="token-line"><span class="token plain">        result += i;</span></div><div class="token-line"><span class="token plain">    }</span></div><div class="token-line"><span class="token plain">    result</span></div><div class="token-line"><span class="token plain">}</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">pub struct WebServer {</span></div><div class="token-line"><span class="token plain">    threads: Vec&lt;(usize, Sender&lt;()&gt;, JoinHandle&lt;usize&gt;)&gt;,</span></div><div class="token-line"><span class="token plain">}</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">impl WebServer {</span></div><div class="token-line"><span class="token plain">    pub fn new(num_threads: usize, no_lock: bool) -&gt; Self {</span></div><div class="token-line"><span class="token plain">        let lock = Arc::new(Mutex::new(()));</span></div><div class="token-line"><span class="token plain">        let threads: Vec&lt;_&gt; = (1..=num_threads)</span></div><div class="token-line"><span class="token plain">            .map(|i| {</span></div><div class="token-line"><span class="token plain">                let (tx, rx) = mpsc::channel::&lt;()&gt;();</span></div><div class="token-line"><span class="token plain">                let lock = Arc::clone(&amp;lock);</span></div><div class="token-line"><span class="token plain">                let handle = std::thread::spawn(move || {</span></div><div class="token-line"><span class="token plain">                    let lock = lock;</span></div><div class="token-line"><span class="token plain">                    let mut total = 0;</span></div><div class="token-line"><span class="token plain">                    while let Ok(_) = rx.recv() {</span></div><div class="token-line"><span class="token plain">                        total += do_work(&amp;lock, no_lock);</span></div><div class="token-line"><span class="token plain">                    }</span></div><div class="token-line"><span class="token plain">                    total</span></div><div class="token-line"><span class="token plain">                });</span></div><div class="token-line"><span class="token plain">                (i, tx, handle)</span></div><div class="token-line"><span class="token plain">            })</span></div><div class="token-line"><span class="token plain">            .collect();</span></div><div class="token-line"><span class="token plain">        WebServer { threads }</span></div><div class="token-line"><span class="token plain">    }</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    pub fn send_work(&amp;self, num_works: usize) {</span></div><div class="token-line"><span class="token plain">        // --snip--</span></div><div class="token-line"><span class="token plain">    }</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    pub fn shutdown(mut self) {</span></div><div class="token-line"><span class="token plain">        // --snip--</span></div><div class="token-line"><span class="token plain">    }</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">}</span></div></pre></div><div class="text">ุจุงู ฺฉุฏ ุฑู ุจุงุฒุด ฺฉูู.</div><div class="text">ุชุงุจุน <code dir="ltr">do_work</code> ฺฉุงุฑ ุฌูุน ฺฉุฑุฏู ู ูุงฺฉ ฺฉุฑุฏู ุฑู ุจุฑุงููู ุงูุฌุงู ูุฏู.
ุงุฒ ูุฑูุฏ ฺฉ ููฺฏ ุจุง ูุงู
<code dir="ltr">no_lock</code>
ูู ุฏุงุฑู ูฺฏุฑู ฺฉู ูููุน ุงุฌุฑุง ุฏุฑ ุฏู ุญุงูุช ุจุง ูุงฺฉ ู ุจุฏูู ุงูู ุฑู ุงุฌุฑุง ฺฉูู ุชุง ุจุจูู
ุงุถุงูู ฺฉุฑุฏู ูุงฺฉ ฺูุฏุฑ ุชู ูพุฑูุฑููุณ ุชุงุซุฑ ฺฏุฐุงุฑู.</div><div class="text">ูุจ ุณุฑูููู ูู ูููุช ุชุฑุฏ ูุณุช
ฺฉู ูููุน ุงุฌุงุฏ ุดุฏู ูุงุฏ ุจู ุชุนุฏุงุฏ ุฎูุงุณุชู ุดุฏูุ ุชุฑุฏ ุจุงุฒ ูฺฉูู ู ฺฉ ูุงฺฉ ูุดุชุฑฺฉ ุจู ููุดูู ูุฏู.</div><div class="text">ฺฉ ุชุงุจุน ุจุง ูุงู
<code dir="ltr">send_work</code>
ุฏุงุฑู ฺฉู ฺฉุงุฑุด ุงุฑุณุงู ููุฒูุงู n ุฏุฑุฎูุงุณุช ุจุง ูู ูุณุช.</div><div class="text">ุฏุฑ ููุงุช ฺฉุงุฑ ุชุงุจุน
<code dir="ltr">shutdown</code>
ุงูู ฺฉู ูุทูู ุจุดู ููู ุชุฑุฏ ูุง ุณุฑูุฑ ฺฉุงุฑุดูู ุชููู ุจุดู ู ุจุนุฏ ุณุฑูุฑ ุฑู ุจุจูุฏู.</div><blockquote><div class="text">ูฺฉุชู ููู: ูููุน ุงุฌุฑุง ฺฉุฏ ฺูู ูุง ุงุฒ ูุงฺฉ ุงุณุชูุงุฏูโ ูุงูุน ููโฺฉููุ ฺฉุงููพูุฑ ุฑุงุณุช ุชู ูพุฑููุงู
<code dir="ltr">release</code>
ุงุด ูุงุฏ ุงููู optimize ูโฺฉูู.
ุงฺฏุฑ ูุฎูุงุฏ ฺฉุฏ ุฑู ุงุฌุฑุง ฺฉูุฏ ุง ุงููู ุชู ุญุงูุช
<code dir="ltr">debug</code>
ุงุฌุฑุง ฺฉูุฏ ุง ุงูฺฉู ุงู ุขูพุดู ุฑู ุจู ูพุฑููุงู
<code dir="ltr">release</code>
ุงุชูู ุชู <code dir="ltr">Cargo.toml</code>
ุงุถุงูู ฺฉูุฏ: <code dir="ltr">opt-level = 2</code></div></blockquote><div class="text">ุงุฌุฑุง ฺฉูู ู ูุชุฌุด ุฑู ุจุจูู:</div><div style="position:relative"><pre class="prism-code language-shell"><div class="token-line"><span class="token plain">$ cargo run --release</span></div><div class="token-line"><span class="token plain">with lock took </span><span class="token number">20</span><span class="token plain">.474073198s</span></div><div class="token-line"><span class="token plain">without lock took </span><span class="token number">3</span><span class="token plain">.526799261s</span></div></pre></div><div class="text">ูุชุฌู ููฺฉูู ุชู ุณุณุชู ุดูุง ูุชูุงูุช ุจุงุดู ูู ฺุฒ ฺฉู ูุดุฎุต ูุณุช ุงูู ฺฉู ูุณุฎู ุจุฏูู ูุงฺฉ ฺูุฏู ุจุฑุงุจุฑ ุณุฑุนโุชุฑ ูุณุช ู ุชุงุซุฑ ุฒุงุฏ
ูุชููู ุฑู ูพุฑูุฑููุณ ุจุฒุงุฑู.</div><div class="text">ุจุฑุง ุงูฺฉู ูุทูู ุจุดู ฺฉู ุฎูุฏ ุนููุงุช ูุงฺฉ ฺฉุฑุฏู ุฏุงุฑู ุฑู ูพุฑูุฑููุณ ุชุงุซุฑ ูุฒุงุฑู ูุชููู ุจุง ุงุณุชูุงุฏู ุงุฒ ุงุจุฒุงุฑ
<a href="https://github.com/flamegraph-rs/flamegraph" dir="ltr">cargo-flamegraph</a>
ูููุฏุงุฑ
flamegraph
ุงููู ุงุฌุงุฏ ฺฉูุฏ.</div><div style="position:relative"><pre class="prism-code language-shell"><div class="token-line"><span class="token plain">$ cargo flamegraph -c </span><span class="token string">&#x27;perf record -F 997 --call-graph dwarf -g&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">[</span><span class="token plain"> perf record: Woken up </span><span class="token number">3009</span><span class="token plain"> </span><span class="token builtin class-name">times</span><span class="token plain"> to </span><span class="token function">write</span><span class="token plain"> data </span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">Warning:</span></div><div class="token-line"><span class="token plain">Processed </span><span class="token number">218901</span><span class="token plain"> events and lost </span><span class="token number">4</span><span class="token plain"> chunks</span><span class="token operator">!</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">Check IO/CPU overload</span><span class="token operator">!</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">[</span><span class="token plain"> perf record: Captured and wrote </span><span class="token number">759.438</span><span class="token plain"> MB perf.data </span><span class="token punctuation">(</span><span class="token number">92749</span><span class="token plain"> samples</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">writing flamegraph to &quot;flamegraph.svg</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">$ </span><span class="token function">open</span><span class="token plain"> flamegraph.svg</span></div></pre></div><div class="text"><a class="img-container" href="/images/ratelimit_mutex_flamegraph.png" target="_blank"><img src="/images/ratelimit_mutex_flamegraph.png" alt="mutex flamegraph" dir="ltr"/></a></div><div class="text">ูุณูุช ุขุจุ ุนููุงุช ูุฑุจูุท ุจู ูุงฺฉ ฺฉุฑุฏู ูุซู ููุชุธุฑ ูููุฏู ู ุขููุงฺฉ ุดุฏู ุฑู ูุดูู ูุฏู ฺฉู ูุจูู ุญุฌู ุฒุงุฏ ุงุฒ ุฒูุงู ุจุฑูุงูู ุฑู ุงูฺฉุงุฑ ฺฏุฑูุชู.</div><blockquote><div class="text">ุจุฑุง ุฏุฏู ูุณุฎู interactive ู ฺฉุงูู ูููุฏุงุฑ ุจุงูุงุ
<a href="/images/ratelimit_mutex_flamegraph.svg" dir="ltr">ุงูุฌุง</a>
ุฑุง ฺฉูฺฉ ฺฉูุฏ.</div></blockquote><div class="text">TODO: ุงุฑุฒุดุดู ุฏุงุฑู ุจุฑู ุจู ุฑุงู ุญู ูุง ุฏฺฏู ูฺฏุงู ุจูุฏุงุฒู.</div><ul><li>ฺุฑุง ูุจ ุณุฑูุฑ ุจุฏูู ููุฒูุงู ูุนู ููุฏู. ุชูุถุญ ุฏุฑ ููุฑุฏ
async ู thread ู ุญุช ck1000 ฺุงูุด.</li><li>ูุทุฑุญ ฺฉุฑุฏู ฺฉ ูุจ ุณุฑูุฑ ูููุช ุชุฑุฏ.</li><li>ุงุดุชุฑุงฺฉ ฺฏุฐุงุฑ ุฏุงุฏู ุจุง ุงุณุชูุงุฏู mutex<ul><li>ุจูฺโูุงุฑฺฉ</li><li>ุชุนูู ู ุงุณุชูุงุฏู ุงุฒ futex<ul><li>ุจูฺโูุงุฑฺฉ</li></ul></li></ul></li><li>ุงุณุชูุงุฏู ุงุฒ atomic ุจุฌุง ูุงฺฉ</li><li>ูุนูุงุฑ nginx ู ฺุงูุด ูุง ฺูุฏ ูพุฑุงุณุณ</li><li>ุชูุถุญ ุฏูู ุฏุฑ ููุฑุฏ ุงูฺฉู ุฏุณุชุฑุณ ูููุฑ ุชู ฺูุฏ ูพุฑุงุณุณ ฺุทูุฑ ูุณุช.</li><li>ุงุดุชุฑุงฺฉ ูููุฑ ุจุง ุงุณุชูุงุฏู ุงุฒ shared memory<ul><li>ุขุง ุงุณุชูุงุฏู ุงุฒ ุงุชูฺฉ ุจู ูพุฑุงุณุณ ูุง ุณู ูุณุชุ</li></ul></li></ul><div class="text">ูุณูุช ุจุนุฏ</div><ul><li>ุฑูุด ูุง ุฏฺฏู ุงุดุชุฑุงฺฉ ูููุฑ ุฏุฑ ฺูุฏ ูพุฑุงุณุณ</li></ul><hr/><h3>ูพุงููุณ</h3><ol class="footnotes"></ol><h3>ููุงุจุน</h3><div dir="ltr" class="resources"><div class="text">[<!-- -->1<!-- -->]<!-- -->: </div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/ratelimit-p2/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-d69664561c90ab43065f.js"],"app":["/app-6065ccb4df465e7f2f5d.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-f320ba337d28ea2b66b6.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-598c6d4faa85a670f219.js"],"component---src-pages-ratelimit-p-1-mdx":["/component---src-pages-ratelimit-p-1-mdx-e6a2f79308b17ab1af8e.js"],"component---src-pages-ratelimit-p-2-mdx":["/component---src-pages-ratelimit-p-2-mdx-d396b307766e78b1a114.js"],"component---src-pages-v-8-ignition-mdx":["/component---src-pages-v-8-ignition-mdx-81a18377b88f88e9a629.js"],"component---src-pages-v-8-mdx":["/component---src-pages-v-8-mdx-a3e700e62668fa47202f.js"],"component---src-pages-v-8-parser-mdx":["/component---src-pages-v-8-parser-mdx-2d45c7f76e544a018b51.js"]};/*]]>*/</script><script src="/polyfill-d69664561c90ab43065f.js" nomodule=""></script><script src="/component---src-pages-ratelimit-p-2-mdx-d396b307766e78b1a114.js" async=""></script><script src="/5e999c8c245179cb3a2ef9e4a39c885397d99ba6-cda9dcdd44aeb28b65a8.js" async=""></script><script src="/app-6065ccb4df465e7f2f5d.js" async=""></script><script src="/framework-02d188296aa8e09a771c.js" async=""></script><script src="/webpack-runtime-0d9786d76e01cb556047.js" async=""></script></body></html>