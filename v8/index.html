<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link href="https://fonts.googleapis.com/css?family=Source Code Pro" rel="stylesheet"/><style data-href="/styles.41c365c0c993c6df84a7.css" data-identity="gatsby-global-css">:root{--lr-padding:10px;--border-radius:8px;--primary-color-active:#ff7e14;--primary-color-inactive:#ffd1ac;--secondary-color:#fffcf9;--anim-duration:300ms;--paragraph-width:calc(min(760px, 100%));--code-width:min(100%,calc(var(--paragraph-width) + 12%));--paragraph-padding:calc(var(--code-width)/2 - var(--paragraph-width)/2);font-size:16px}.footnotes,.main-container h1,.text,a,em,h2,h3,h4,h5,h6,li,p,ul{direction:rtl;font-family:Vazir,monospace,Source Code Pro!important;line-height:1.6}.main-container h1,h2,h3,h4,h5,h6{padding-left:var(--paragraph-padding);padding-right:var(--paragraph-padding)}.text a{overflow-wrap:anywhere}.footnotes li{color:#5c6e74;font-size:.8rem!important}.main-container-wrapper{align-items:center;display:flex;flex-direction:column;width:100%}.main-container p{margin:0}a{text-decoration:none}a,a:hover{color:var(--primary-color-active)}a:hover{text-decoration:underline}.main-container{padding-top:1rem;width:var(--code-width)}.main-container img{display:block;margin-left:auto;margin-right:auto;max-height:500px;max-width:80%}.main-container .img-container{max-width:100%}@media screen and (max-width:768px){:root{--lr-padding:10%}}@media screen and (max-width:375px){:root{--lr-padding:5%}.main-container{margin-top:0;padding-top:0!important}.main-container h1{margin-top:10px}.main-container blockquote{margin:25px 0 0}.main-container img{max-width:100%;vertical-align:top}.main-container .img-container{overflow-x:auto}}.main-container li{font-size:1.2rem;margin-left:var(--paragraph-padding);margin-right:var(--paragraph-padding);margin-top:.6rem;padding:0;text-align:justify}.main-container p,.text{font-size:1.2rem;padding-left:var(--paragraph-padding);padding-right:var(--paragraph-padding);text-align:justify}.main-container blockquote .text{--h-space:10px;--v-space:4px;background-color:#e7e7e7;border-radius:var(--border-radius);border-right:5px solid var(--primary-color-inactive);margin-left:calc(var(--paragraph-padding)*1.3);margin-right:calc(var(--paragraph-padding)*1.3);padding:var(--v-space) var(--h-space);transition:border-right var(--anim-duration)}.main-container blockquote .text:hover{border-right-color:var(--primary-color-active)}.resources .text{direction:ltr;font-size:.8rem;text-align:start}.main-container code{background-color:#f1f1f1;border-radius:var(--border-radius);direction:ltr!important;font-size:1.1rem;padding-left:6px;padding-right:6px;text-align:left;white-space:nowrap}.playground-button{background-color:var(--primary-color-active);border-bottom-left-radius:var(--border-radius);padding:0 5px;position:absolute;right:0;top:0}.playground-button a{color:#fff;font-size:.8rem;margin:0}.playground-button a:hover{text-decoration:none}code[class*=language-],pre[class*=language-]{color:#5c6e74;direction:ltr;font-family:Source Code Pro,Andale Mono,Ubuntu Mono,monospace;font-size:1rem;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;text-align:left;text-shadow:none;white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-]::mozselection,code[class*=language-]::selection,pre[class*=language-]::mozselection,pre[class*=language-]::selection{background:#b3d4fc;text-shadow:none}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{background:var(--secondary-color);border:1px solid var(--primary-color-inactive);border-radius:var(--border-radius);margin:.5em 0;overflow:auto;padding:.8em;transition:border var(--anim-duration)}pre[class*=language-]:hover{border:1px solid var(--primary-color-active)}:not(pre)>code[class*=language-]{background:#f9f2f4;border-radius:.3em;color:#db4c69;padding:.1em .3em}.namespace{opacity:.7}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#93a1a1}.token.punctuation{color:#999}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{background:#fff;color:#a67f59}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}pre[data-line]{position:relative}pre[class*=language-]>code[class*=language-]{position:relative;z-index:1}.line-highlight{background:#f7ebc6;box-shadow:inset 5px 0 0 #f7d87c;left:0;line-height:inherit;margin-top:1em;padding-bottom:inherit;padding-left:0;padding-right:0;padding-top:inherit;pointer-events:none;position:absolute;right:0;white-space:pre;z-index:0}.footnotes,.post-list-container h1,.text,a,em,h2,h3,h4,h5,h6,li,p,ul{font-family:Vazir,monospace,Source Code Pro!important;line-height:1.6;margin:0;padding:0}.post-list-container ul{list-style-type:circle;padding:0}.post-list-container li a{color:#121212;-webkit-text-decoration-style:dotted;text-decoration-style:dotted}.post-list-container li{margin-top:16px}.category-container .badge{background-color:var(--primary-color-active);border-radius:5px;color:#fff;margin-left:5px;padding-left:4px;padding-right:4px}.post-list-container{direction:rtl;display:flex;flex-direction:row;flex-wrap:wrap;padding:3rem}.category-container{margin:2rem 1rem;width:calc(50% - 2rem)}.category-container .hr{background-color:var(--primary-color-active);border-radius:5px;height:5px;margin-bottom:1rem;margin-top:.1rem;width:40%}@media screen and (max-width:425px){.category-container{width:100%}.post-list-container{padding:1rem}}.social{display:flex;flex-direction:row;font-family:Source Code Pro!important;font-size:.9rem;justify-content:center;margin-top:20px;width:100%}.social a{color:grey!important;opacity:.6;transition:.2s}.social a:hover{opacity:1}.social p{margin-left:10px;margin-right:10px}</style><meta name="generator" content="Gatsby 4.1.3"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><title data-react-helmet="true">V8 چیه و چطور کار می‌کنه؟ - قسمت ۱</title><meta data-react-helmet="true" charSet="utf-8"/><meta data-react-helmet="true" property="og:title" content="V8 چیه و چطور کار می‌کنه؟ - قسمت ۱"/><meta data-react-helmet="true" property="og:site_name" content="Sahand&#x27;s blog"/><link rel="sitemap" type="application/xml" href="/sitemap/sitemap-index.xml"/><link as="script" rel="preload" href="/webpack-runtime-eb92277a3bb70a1028db.js"/><link as="script" rel="preload" href="/framework-02d188296aa8e09a771c.js"/><link as="script" rel="preload" href="/app-fc6519f31c6e62d185e1.js"/><link as="script" rel="preload" href="/b3cb720b120fadd5cd62c0f493389da7ab972379-9ace7c48e7e7a825d7a3.js"/><link as="script" rel="preload" href="/component---src-pages-v-8-mdx-a3e700e62668fa47202f.js"/><link as="fetch" rel="preload" href="/page-data/v8/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="main-container-wrapper"><div class="main-container"><h1>V8 چیه و چطور کار می‌کنه؟ - قسمت ۱</h1><div class="text"><a class="img-container" href="/images/v8_intro_1.png" target="_blank"><img src="/images/v8_intro_1.png" alt="v8-engine" dir="ltr" style="max-height:300px"/></a></div><br/><br/><br/><blockquote><div class="text">این قسمت از سری و احتمالا چند قسمت بعدی اون، خلاصه و ساده شده منابع آخر مطلبه که من اومدم بینش
یکسری مطالب دیگه‌رو هم بهش اضافه کردم یا برای یک مطلبی توضیح بیشتر دادم.</div></blockquote><div class="text">V8 یک موتور برای اجرای جاوااسکریپت و وب‌اسمبلی هست که
در نرم‌افزار های مختلفی مثل
Google chrome
و
nodejs
استفاده می‌شه. این موتور پرفرمنس خیلی بالایی داره و دلیلش خلاقیت و تکنولوژی های جالبی هست که توش استفاده کردن.
هدف این پست اینه که بیاد این پروژه رو معرفی کنه و تا حد خوبی به جزئیات اینکه چطور کار می‌کنه بپردازه.</div><h2>مرحله اول - تولید Abstract Syntax Tree</h2><div class="text">برای اینکه بشه یک کد جاوااسکریپت رو اجرا کرد٬ باید اول کد اونو به یک فرمت مخصوصی تبدیل کنیم که موتور
v8 راحت‌تر بتونه باهاش کار کنه.
این فرمت Abstract Syntax Tree یا AST هست که نشون دهنده ساختار اصلی کده و همه داده های اضافه مثل کامنت
و اسپیس از اون حذف شده.</div><div class="text">مثلا اگر همچین کدی داشته باشیم:</div><div style="position:relative"><pre class="prism-code language-js"><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">salam</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> b </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">b</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">var</span><span class="token plain"> result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">salam</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><div class="text">AST اون می‌شه همچین چیزی:</div><div class="text"><a class="img-container" href="/images/v8_ast_1.png" target="_blank"><img src="/images/v8_ast_1.png" alt="example code AST" dir="ltr"/></a></div><div class="text">برای این‌که V8 این AST رو تولید کنه٬
، باید این مراحل رو طی کنه:</div><div class="text"><a class="img-container" href="/images/v8_building_ast_graph.png" target="_blank"><img src="/images/v8_building_ast_graph.png" alt="building ast graph" dir="ltr"/></a></div><div class="text">بریم ببینیم هر مرحله‌اش داره چیکار می‌کنه.</div><blockquote><div class="text">توی V8 چون تا وقتی AST
نداشته باشیم نمی‌تونیم هیچکاری انجام بدیم٬
V8 میاد AST رو به صورت streaming تولید می‌کنه.
خیلی ساده یعنی مثلا توی کد بالا٬ وقتی تمام کاراکتر های مورد نیازش برای تابع اول رو دریافت کرد
یک Node توی AST ایجاد می‌کنه و اونو بر میگردونه ولی می‌گه هنوز کارش تموم نشده.
اینطوری V8 میتونه مثلا تابع اول رو اجرا کنه با اینکه هنوز بقیه کد رو
parse نکرده.</div></blockquote><h3>Scanner ـ <sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup></h3><div class="text">کامپایلر هر زبان برنامه‌نویسی برای اینکه بتونه خروجی تولید کنه٬ باید اول بتونه کدهای شمارو بفهمه. اولین قدم فهمیدن٬
بررسی رشته ورودی‌ای هست که بهش دادین. اگه کد زیر رو داشته باشیم:</div><div style="position:relative"><pre class="prism-code language-javascript"><div class="token-line"><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">allow </span><span class="token operator">==</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;welcome&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><div class="text">کامپایلر باید توالی کاراکتر های ورودی رو بخونه و اونو تبدیل به توکن کنه که کار فهمیدن راحت‌تر بشه:</div><div class="text"><a class="img-container" href="/images/v8_scanner_1.png" target="_blank"><img src="/images/v8_scanner_1.png" alt="scanner example" dir="ltr"/></a></div><div class="text">فرض کنیم تصویر بالا٬ ساده شده یک scanner برای جاوااسکریپت هست.
کدی رو دادیم بهش و اون توی خروجی بهمون یک توالی از token ها داده.
کار کردن با این توکن ها برای فهم کد به مراتب راحت‌تر از مستقیم کار کردن روی کاراکتر هاست.
مثلا بعدا اگر بخوایم بفهمیم که آیا کاربر اینجا یک شرط نوشته باید دنبال یک الگو از توکن های پشت سر هم باشیم مثلا:</div><div class="text"><code dir="ltr">[..., IF, PARAN_OPEN, IDENT, PARAN_CLOSE, ...]</code>
یا
<code dir="ltr">[..., IF, PARAN_OPEN, KEYWORD, PARAN_CLOSE, ...]</code></div><div class="text">که پیدا کردن این الگو به کمک لیست توکن ها خیلی ساده‌تر هست. این قسمت یک نکته مهمی که داره اینه که ممکنه همچین ورودی داشته باشیم:</div><div style="position:relative"><pre class="prism-code language-javascript"><div class="token-line"><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token boolean">true</span></div></pre></div><div class="text">که توی جاوااسکریپت معنی نمیده ولی
scanner
باز هم توالی توکن
<code dir="ltr">[IF, IF, IF, TRUE]</code>
رو تولید می‌کنه و تایید اعتبار ترکیب درست توکن ها کنار هم توی مرحله بعد یعنی پارسر انجام می‌شه.</div><blockquote><div class="text">نکته: داخل scanner بالا کاراکتر های اضافه مثل فاصله و خط جدید هم حذف شدن ولی لزوما هر کامپایلری این کار رو توی این مرحله انجام نمیده.</div></blockquote><div class="text">به این تیکه از کامپایلر٬ scanner می‌گن.
اسم های دیگه‌ای هم داره مثل lexer و tokenizer
ولی چون توی v8 از scanner استفاده شده٬ توی این مقاله هم با این اسم می‌ریم جلو.</div><div class="text">وقتی یک اپلیکیشن دسکتاپ درست می‌کنیم معمولا اونو کامپایل می‌کنیم و خروجی باینری اونو به کاربر می‌دیم. پس اونقدر
سرعت کامپایلر نباید اهمیت داشته باشه. اما توی جاوااسکریپت سیستم کاربر کد رو از ما میگیره و خودش کارهای
interpreting و compile
رو انجام می‌ده.
اینجاست که نوشتن یک کامپایلر سریع خیلی مهم میشه چون هرچی این کامپایلر سریع‌تر باشه٬ سایت کاربر سریع‌تر بالا میاد.</div><div class="text">به همین علت موتور
v8
نیاز داشته که یکسری کارهای خاص انجام بده که سرعت مراحل مختلف کامپایل بالاتر بره.
مثلا:</div><h4>Comment</h4><div class="text">توی پایتون توی ران‌تایم میتونیم کامنت های یک تابع رو بخونیم. در واقع کامنت ها یک رشته هستن:</div><div style="position:relative"><pre class="prism-code language-python"><div class="token-line"><span class="token keyword">def</span><span class="token plain"> </span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token triple-quoted-string string">&quot;&quot;&quot;comment&quot;&quot;&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token plain">foo</span><span class="token punctuation">.</span><span class="token plain">__doc__</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment"># comment</span></div></pre></div><div class="text">توی زبان <code dir="ltr">C#</code> میتونیم با انتخاب خودمون از طریق
<a href="https://docs.microsoft.com/en-us/archive/msdn-magazine/2019/october/csharp-accessing-xml-documentation-via-reflection" dir="ltr">Reflection</a>
کامنت های از نوع Docstring رو بخونیم.</div><div class="text">همینطور توی زبان rust کامنت های <code dir="ltr">//</code> ایگنور میشن ولی برای کامنت های نوع
Docstring یا <code dir="ltr">//!</code>
توکن درست میشه چون توی سیستم ماکرو اش میتونیم داکیومنت جنریت کنیم.</div><div class="text">اما توی جاوااسکریپت موتور v8 برای اجرا هیچ نیازی به کامنت ها نداره برای همین بهتره که خیلی سریع از روشون بگذره.</div><blockquote><div class="text">لازم نیست که برای سریع‌تر اجرا شدن سایتتون از این به بعد کامنت نزارید. ابزارهایی که دارید همینکار رو موقع build گرفتن براتون میکنن.
مثلا ابزار <a href="https://github.com/mishoo/UglifyJS" dir="ltr">UglifyJs</a> که اگر به پروژه هاتون نگاه کنید٬ پیداش می‌کنید.</div></blockquote><h4>identifier scanning</h4><div class="text">توی v8 پیچیده‌ترین اما پراستفاده ترین توکن٬
توکن <a href="https://source.chromium.org/chromium/v8/v8.git/+/edf3dab4660ed6273e5d46bd2b0eae9f3210157d:src/token.h;l=147" dir="ltr"><code>IDENTIFIER</code></a> هست
که برای
<a href="https://tc39.es/ecma262/#sec-identifiers" dir="ltr">Identifier</a>
تعریف شده داخل داکیومنت فنی
ECMAScript
تولید می‌شه. اسم توابع و متغییر ها٬ Identifier هستن که احتمالا به این موضوع برخوردید که یکسری محدودیت توی انتخاب کاراکتر ها داره:</div><ul><li><strong>ID_START:</strong> اولین کاراکتر باید <code>[a-z]</code> ٬ <code>[A-Z]</code> ٬ <code>$</code> یا <code>_</code> باشه.</li><li><strong>ID_CONTINUE:</strong> در صورت بیشتر از یک حرفی بودن٬ بقیه کاراکتر ها یا باید <em>ID_START</em> باشن٬ یا عدد.</li></ul><div class="text">یکی از مهمترین دلایل این محدودیت٬ کاهش ابهام یا ambiguity توی زبان هست.
فرض کنیم کاراکتر <code dir="ltr">-</code> یک کاراکتر مجاز توی identifier باشه. اگه کد زیر رو داشته باشیم:</div><div style="position:relative"><pre class="prism-code language-javascript"><div class="token-line"><span class="token keyword">var</span><span class="token plain"> a </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">var</span><span class="token plain"> b </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">var</span><span class="token plain"> a</span><span class="token operator">-</span><span class="token plain">b </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token operator">-</span><span class="token plain">b </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword control-flow">else</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><div class="text">چنتا برداشت می‌تونیم داشته باشیم:</div><ul><li><strong>برداشت ۱:</strong> <code>a-b</code> اشاره میکنه به مقدار داخل متغییر تعریف شده با همین نام.</li><li><strong>برداشت ۲:</strong> مقدار متغییر با نام <code>b</code> از مقدار متغییر با نام <code>a</code> کم میشه و حاصلشون با صفر مقایسه میشه.</li></ul><div class="text">اگر بخوایم هرکدوم از اینارو پیاده سازی کنیم
باید برای تولید هر توکن بیایم همه توکن های قبلی رو چک کنیم
و مطمینم بشیم که همچین Identifier ای رو کاربر قبلا تعریف کرده یا نه و نسبت به اون ۱ توکن درست کنیم یا ۳ تا توکن.</div><div class="text">توی زبان جاوااسکریپت یک تابع بنام <code dir="ltr">eval</code> داریم که اجازه بهمون میده کد های داینامیک اجرا کنیم که باز کارو پیچیده‌تر هم میکنه.</div><div class="text">برای اینکه بتونیم یک scanner سریع بنویسیم
هرچی کار کمتری داشته باشیم٬ کارمون هم سریع‌تر تموم می‌شه. این ابهامات پیچیدگی و درنتیجه حجم کارمون رو بیشتر میکنن و درنهایت
یک scanner کند خواهیم داشت.
حالا چون این توکن پراستفاده‌ترین توکن هست٬ اضافه کردن کوچیک‌ترین پیچیدگی هم باعث کاهش پرفرمنس میشه.</div><div class="text">توی جاوااسکریپت چون identifier خیلی محدود هست کار اسکنر هم خیلی ساده میشه
کافیه وقتی به یک <em dir="ltr">ID_START</em> رسید٬ تا وقتی که کاراکتر های بعدی <em dir="ltr">ID_CONTINUE</em> هستن اونارو بعنوان
identifier درنظر بگیره و نیاز نیست تحلیل خاصی هم روی تک تک کاراکتر ها انجام بده.</div><h4>Keywords</h4><div class="text">keyword ها زیرمجوعه identifier هستن.
برای مثال وقتی scanner به عبارت <code dir="ltr">if</code> می‌رسه٬ این عبارت رو مثل یک
identifier اسکن می‌کنه ولی وقتی میخواد توکن برگردونه٬
باید چک کنه که اگر عبارت یکی از keyword ها بود٬ بجای توکن
<code dir="ltr">IDENT</code>٬ توکن مربوط به keyword رو برگردونه که توی مثال ما می‌شه
توکن <a href="https://source.chromium.org/chromium/v8/v8.git/+/edf3dab4660ed6273e5d46bd2b0eae9f3210157d:src/token.h;l=124" dir="ltr"><code>IF</code></a>.
چون این چک کردن باید برای هر identifier انجام بشه و قبل‌تر گفتیم که معمول‌ترین توکن٬ <code dir="ltr">IDENT</code> هست٬
این چک کردن رو هرچی بهینه‌تر پیاده سازی کنیم٬‌ می‌تونه تاثیر قابل توجهی روی پرفرمنس بزاره.</div><div class="text">یک پیاده سازی ساده اون٬ میتونه استفاده از <code dir="ltr">HashMap</code> باشه:</div><div style="position:relative"><pre class="prism-code language-javascript"><div class="token-line"><span class="token keyword">const</span><span class="token plain"> keywords </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">   </span><span class="token string">&#x27;if&#x27;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Token</span><span class="token punctuation">.</span><span class="token constant">IF</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">   </span><span class="token string">&#x27;function&#x27;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Token</span><span class="token punctuation">.</span><span class="token constant">FUNCTION</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">   </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">getKeyword</span><span class="token punctuation">(</span><span class="token parameter">ident</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> keywords</span><span class="token punctuation">[</span><span class="token plain">ident</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><div class="text">پیچیدگی زمانی <code dir="ltr">HashMap</code> یا <code dir="ltr">HashTable</code>٬ <code dir="ltr">O(1)</code> در حالت میانگین هست.
در بدترین حالت اما این پیچیدگی زمانی <code dir="ltr">O(n)</code> هست.
بدترین حالت وقتی پیش میاد که ما collision داشته باشیم.
برای فهمیدن این مشکل باید بدونیم یک <code dir="ltr">HashMap</code> چطور کار می‌کنه.</div><div class="text">فرض کنیم ما توی زبانی که داریم استفاده می‌کنیم فقط <code dir="ltr">List</code> داریم و نیاز داریم یک
‍<code dir="ltr">HashMap</code> پیاده سازی کنیم.
اولین چیزی که نیاز داریم٬ یک <a href="https://en.wikipedia.org/wiki/Hash_function" dir="ltr">hash function</a> هست.
کار این تابع اینه که از ورودی یک مقداری با هر اندازه ای رو بگیره و یک مقدار با اندازه ثابت بهمون بده.
مثلا یک string بگیره و یک <code dir="ltr">u32</code> بهمون بده. <code dir="ltr">md5</code>, <code dir="ltr">sha256</code> دوتا hash function معروف هستن که
احتمالا باهاشون قبلا کار کردید. اینجا اما تابعی مثل
<a href="https://en.wikipedia.org/wiki/Cyclic_redundancy_check" dir="ltr"><code>crc32</code></a>
بیشتر بدرد می‌خوره.</div><div class="text">اگه بیایم مقادیر زیر رو به این تابع بدیم٬ خروجی های زیر تولید میشه:</div><div style="position:relative"><pre class="prism-code language-javascript"><div class="token-line"><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token function">crc32</span><span class="token punctuation">(</span><span class="token string">&#x27;if&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// 1362560636</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token function">crc32</span><span class="token punctuation">(</span><span class="token string">&#x27;function&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// 3400406589</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token function">crc32</span><span class="token punctuation">(</span><span class="token string">&#x27;while&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// 3235141117</span></div></pre></div><blockquote><div class="text"><a href="https://crccalc.com/" dir="ltr">اینجا</a> می‌تونید آنلاین این تابع رو امتحان کنید.</div></blockquote><div class="text">حالا ما یک تابعی داریم که هر رشته ای رو تبدیل به یک عدد بین <code dir="ltr">0</code> تا <code dir="ltr">4294967295</code> می‌کنه.
می‌تونیم الآن یک آرایه داشته باشیم که اندازش <code dir="ltr">4294967296</code> باشه و برای پیاده کردن یک المان کافیه هش کلید اون رو بدست بیاریم
و نتیجش میشه index ای که مقدار کلیدمون توش قرار داره:</div><div style="position:relative"><pre class="prism-code language-javascript"><div class="token-line"><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">HashTable</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  elements</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token parameter punctuation">,</span><span class="token parameter"> value</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> idx </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">crc32</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">elements</span><span class="token punctuation">[</span><span class="token plain">idx</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> value</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">get</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> idx </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">crc32</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">elements</span><span class="token punctuation">[</span><span class="token plain">idx</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> table </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">HashTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">table</span><span class="token punctuation">.</span><span class="token method function property-access">insert</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">table</span><span class="token punctuation">.</span><span class="token method function property-access">insert</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">table</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// 1</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">table</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// 2</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">table</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// undefined</span></div></pre></div><div class="text">این پیاده سازی ۲ تا مشکل داره:</div><ul><li>اگه دوتا مقدار مختلف یک هش یکسان داشته باشن٬ توی یک خونه قرار می‌گیرن و collision داریم.</li><li>حافظه زیادی می‌گیره چون نیاز داریم برای هر <code>HashMap</code> یک لیست به اندازه <code>4294967296</code> المان داشته باشیم.</li></ul><div class="text">بیایم اول مشکل اولی رو حل کنیم. بیایم بجای اینکه داخل هر المان یک مقدار ذخیره کنیم٬ یک لیستی از مقادیر ذخیره کنیم و وقتی
به collision رسیدیم٬ مقدارمون رو به اون لیست اضافه کنیم.
وقتی هم میخوایم یک المان رو lookup کنیم اول با هش توی لیست اصلی مستقیم به خونه مورد نظرمون می‌رسیم٬
بعد میایم یک سرچ خطی توی آرایه داخلی می‌زنیم. دلیل اینکه بدترین حالت
<code dir="ltr">O(n)</code> هست هم همینجاست٬ چون مجبوریم اینجا سرچ خطی انجام بدیم.</div><div class="text"><a class="img-container" href="/images/v8_hashmap_impl.png" target="_blank"><img src="/images/v8_hashmap_impl.png" alt="Hash map impl" dir="ltr"/></a></div><div style="position:relative"><pre class="prism-code language-javascript"><div class="token-line"><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">HashTable</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  elements</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token parameter punctuation">,</span><span class="token parameter"> value</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> idx </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">crc32</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">let</span><span class="token plain"> bucket </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">elements</span><span class="token punctuation">[</span><span class="token plain">idx</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">bucket </span><span class="token operator">==</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      bucket </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">elements</span><span class="token punctuation">[</span><span class="token plain">idx</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> bucket</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> oldValueIdx </span><span class="token operator">=</span><span class="token plain"> bucket</span><span class="token punctuation">.</span><span class="token method function property-access">findIndex</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> x</span><span class="token punctuation">.</span><span class="token property-access">key</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> key</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">oldValueIdx </span><span class="token operator">==</span><span class="token plain"> </span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      bucket</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> key</span><span class="token punctuation">,</span><span class="token plain"> value </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword control-flow">else</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      bucket</span><span class="token punctuation">[</span><span class="token plain">oldValueIdx</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> key</span><span class="token punctuation">,</span><span class="token plain"> value </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">get</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">let</span><span class="token plain"> idx </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">crc32</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">let</span><span class="token plain"> bucket </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">elements</span><span class="token punctuation">[</span><span class="token plain">idx</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">bucket </span><span class="token operator">==</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> bucket</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> x</span><span class="token punctuation">.</span><span class="token property-access">key</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> key</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> table </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">HashTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">table</span><span class="token punctuation">.</span><span class="token method function property-access">insert</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">table</span><span class="token punctuation">.</span><span class="token method function property-access">insert</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">table</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// 1</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">table</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// 2</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">table</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// null</span></div></pre></div><div class="text">مشکل دوم اینه که الآن پیاده سازیمون مموری زیادی میگیره. مثلا اگه هش <code dir="ltr">&quot;a&quot;</code> رو حساب کنیم می‌شه <code dir="ltr">3904355907</code>.
یعنی مقدارش باید توی خونه <code dir="ltr">3904355907</code> قرار بگیره و همه خونه قبلی لیستمون خالی و بدون استفاده هستن.
برای رفع این مشکل میتونیم یک محدوده حافظه مشخص کنیم. مثلا بگیم اندازه لیستمون فقط 100 المان باشه
و برای پیاده کردن index درست٬ کافیه مقدار هش رو بر اندازمون تقسیم کنیم و باقی موندش رو بعنوان index استفاده کنیم:</div><blockquote><div class="text">یکی از پر استفاده کارای عمل باقی مونده، همین تبدیل یک رنج بزرگ به یک رنج کوچیک‌تر با اندازه مشخص هست.</div></blockquote><div style="position:relative"><pre class="prism-code language-javascript"><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token constant">CAPACITY</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">100</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">class</span><span class="token plain"> </span><span class="token class-name">HashTable</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  elements</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token parameter punctuation">,</span><span class="token parameter"> value</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> idx </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">crc32</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">%</span><span class="token plain"> </span><span class="token constant">CAPACITY</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">let</span><span class="token plain"> bucket </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">elements</span><span class="token punctuation">[</span><span class="token plain">idx</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">bucket </span><span class="token operator">==</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      bucket </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">elements</span><span class="token punctuation">[</span><span class="token plain">idx</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> bucket</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> oldValueIdx </span><span class="token operator">=</span><span class="token plain"> bucket</span><span class="token punctuation">.</span><span class="token method function property-access">findIndex</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> x</span><span class="token punctuation">.</span><span class="token property-access">key</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> key</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">oldValueIdx </span><span class="token operator">==</span><span class="token plain"> </span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      bucket</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> key</span><span class="token punctuation">,</span><span class="token plain"> value </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword control-flow">else</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      bucket</span><span class="token punctuation">[</span><span class="token plain">oldValueIdx</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> key</span><span class="token punctuation">,</span><span class="token plain"> value </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">get</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">let</span><span class="token plain"> idx </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">crc32</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">%</span><span class="token plain"> </span><span class="token constant">CAPACITY</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">let</span><span class="token plain"> bucket </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">elements</span><span class="token punctuation">[</span><span class="token plain">idx</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">bucket </span><span class="token operator">==</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> bucket</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> x</span><span class="token punctuation">.</span><span class="token property-access">key</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> key</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> table </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">HashTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">table</span><span class="token punctuation">.</span><span class="token method function property-access">insert</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">table</span><span class="token punctuation">.</span><span class="token method function property-access">insert</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">table</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// 1</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">table</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// 2</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">table</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// null</span></div></pre></div><blockquote><div class="text">دقت کنید که یک پیاده سازی یک HashMap خیلی پیچیده‌تر از چیزی هست که بالا نوشته شده و متن بالا
فقط ایده اصلی Hash Table رو توضیح می‌ده.</div></blockquote><div class="text">دیدیم که استفاده از <code dir="ltr">HashMap</code> لزوما همیشه <code dir="ltr">O(1)</code> به ما نمیده و نسبت به شرایط ممکنه بیشتر طول بکشه.
بدلیل همیشه مشخص نبودن پرفرمنس <code dir="ltr">HashMap</code>٬ v8 از چیزی به نام <a href="https://en.wikipedia.org/wiki/Perfect_hash_function" dir="ltr">Perfect Hash Function</a> استفاده می‌کنه.
PHF ها دسته توابع هش ای هستند که اگر ما
n ورودی مختلف داشته باشیم٬
می‌تونه تابعی به ما بده که خروجیش یک عدد بین
۱ تا n هست.
شبه‌کد زیر رو نگاه کنید:</div><div style="position:relative"><pre class="prism-code language-javascript"><div class="token-line"><span class="token keyword">let</span><span class="token plain"> hasher </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">PerfectHash</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;c&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">hasher</span><span class="token punctuation">.</span><span class="token method function property-access">hash</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">// 0</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">hasher</span><span class="token punctuation">.</span><span class="token method function property-access">hash</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">// 1</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">hasher</span><span class="token punctuation">.</span><span class="token method function property-access">hash</span><span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">// 2</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">hasher</span><span class="token punctuation">.</span><span class="token method function property-access">hash</span><span class="token punctuation">(</span><span class="token string">&quot;e&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">// error</span></div></pre></div><div class="text">حالا چون ما تمام keyword هامون رو می‌دونیم٬ می‌تونیم از
این روش استفاده کنیم و یک hash function مخصوص خودمون رو داشته باشیم.
حالا اگر این تابع هش رو توی پیاده سازی hash table مون دخیل کنیم٬‌
می‌تونیم یک lookup با هزینه زمانی بدترین حالت <code dir="ltr">O(1)</code> داشته باشیم٬ چون
هیچ‌وقت collision نخواهیم داشت.</div><blockquote><div class="text">لیست همه keyword های جاوااسکریپت رو می‌تونید <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Lexical_grammar#keywords" dir="ltr">اینجا</a> ببینید.</div></blockquote><h4>Whitespace</h4><div class="text">برای کاراکتر فاصله٬ خط جدید٬ تب و کامنت‌ها٬
یک توکن <a href="https://source.chromium.org/chromium/v8/v8.git/+/edf3dab4660ed6273e5d46bd2b0eae9f3210157d:src/token.h;l=166" dir="ltr"><code>WHITESPACE</code></a> توی v8 تولید می‌شه.
اکثر پارسر ها میان کلا این کاراکتر هارو درنظر نمی‌گیرن و هیچ توکنی هم براشون درست نمی‌کنن ولی
v8 نیاز داره براشون توکن تولید کنه.
یکی از اصلی‌ترین دلایلش٬
<a href="https://tc39.es/ecma262/#sec-automatic-semicolon-insertion" dir="ltr">Automatic Semicolon Insertion</a>
هست که توی داکیومنت فنی
ECMAScript
اومده. توی جاوااسکریپت اجازه داریم که توی کدمون <code dir="ltr">;‍</code> رو حذف کنیم که این قابلیت یکسری پیچیدگی ها برامون اضافه می‌کنه. مثال زیر رو نگاه کنید:</div><div style="position:relative"><pre class="prism-code language-javascript"><div class="token-line"><span class="token keyword control-flow">return</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">a </span><span class="token operator">+</span><span class="token plain"> b</span></div></pre></div><div class="text">این کد به دو صورت میتونه تحلیل بشه:</div><div class="text"><strong dir="ltr">حالت اول</strong></div><div style="position:relative"><pre class="prism-code language-javascript"><div class="token-line"><span class="token keyword control-flow">return</span><span class="token plain"> a </span><span class="token operator">+</span><span class="token plain"> b</span><span class="token punctuation">;</span></div></pre></div><div class="text"><strong dir="ltr">حالت دوم</strong></div><div style="position:relative"><pre class="prism-code language-javascript"><div class="token-line"><span class="token keyword control-flow">return</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">a </span><span class="token operator">+</span><span class="token plain"> b</span><span class="token punctuation">;</span></div></pre></div><div class="text">که یکیشون مقدار برمی‌گردونه و اون یکی نمیکنه.
v8 حالت دوم رو در نظر میگیره حتی اگر ممکنه اشتباه باشه چون به کد اصلی که کاربر نوشته نزدیک‌تره و برای اینکه بتونه اینکارو بکنه
باید بدونه که بعد <code dir="ltr">return</code> خط جدید درست شده و برای همین هم به توکن <code dir="ltr">WHITESPACE</code> نیاز داره.</div><div class="text">یک مثال دیگه:</div><div style="position:relative"><pre class="prism-code language-javascript"><div class="token-line"><span class="token plain">a </span><span class="token operator">=</span><span class="token plain"> b</span></div><div class="token-line"><span class="token plain"></span><span class="token operator">++</span><span class="token plain">c</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// after automatic semicolon insertion:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">a </span><span class="token operator">=</span><span class="token plain"> b</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token operator">++</span><span class="token plain">c</span><span class="token punctuation">;</span></div></pre></div><div class="text"><strong dir="ltr">:نکته مهم</strong> تو بعضی شرایط اینکارو رو انجام نمی‌ده
(بخاطر backward compatibility):</div><div style="position:relative"><pre class="prism-code language-javascript"><div class="token-line"><span class="token plain">a </span><span class="token operator">=</span><span class="token plain"> b </span><span class="token operator">+</span><span class="token plain"> </span><span class="token function">c</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">(</span><span class="token plain">d </span><span class="token operator">+</span><span class="token plain"> e</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// same as</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">a </span><span class="token operator">=</span><span class="token plain"> b </span><span class="token operator">+</span><span class="token plain"> </span><span class="token function">c</span><span class="token punctuation">(</span><span class="token plain">d </span><span class="token operator">+</span><span class="token plain"> e</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">a </span><span class="token operator">=</span><span class="token plain"> c</span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// same as</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">a </span><span class="token operator">=</span><span class="token plain"> c</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><blockquote><div class="text">درست هندل کردن
whitespace ها توی اسکنر/پارسر ای که می‌نویسی بطوری که کد رو اسپاگتی نکنه٬
یکی از چالش های پارسر نوشتن هست.</div></blockquote><h3>Parser ـ <sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup></h3><div class="text">پارس کردن مرحله‌ای است که سورس کد شما تبدیل به یک فرمت میانی قابل استفاده توسط کامپایلر می‌شه. چون پارس کردن در مسیر اصلی پردازش شدن یک وبسایت انجام می‌شه و روی لود شدن اولیه اون تاثیر مستقیم داره، خوبه که هیچ کار اضافه‌ای انجام ندیم.
همه تابع های کد شما برای استارتاپ و اجرای اولیه سایت شما لازم نیستن. مثلا اگه از فریمورک react استفاده می‌کنید٬
کامپوننت های شما فانکشن اند و لزوما توی یک صفحه همه کامپوننت ها دیده نمی‌شن.</div><div class="text">اگه بخوایم همه کد رو همون اول پارس و کامپایل کنیم (کامپایل اینجا یعنی تبدیل
ast به bytecode موتور ignition v8 هست)٬
منابع سیستم رو به خوبی استفاده نکردیم.</div><blockquote><div class="text">توی v8 یک چیزی هست به نام bytecode flushing که میاد تیکه کد هایی که خیلی وقته استفاده نشدن یا کلا دیگه
امکان استفاده شدنشون وجود نداره رو از مموری خارج می‌کنه. میشه روی این فیچر حساب باز کرد که کدهای
استفاده نشده مموری مصرف نکنن اما این نکته رو باید در نظر داشته باشیم که اگه ما همون اول بیایم همه کد رو
ببریم توی رم ۱-لود اولیه سایت رو کند کردیم ۲-تا وقتی که سایکل bytecode flushing انجام نشه٬ مموری رو اشغال کردیم
و اگه سیستم رمش توی این لحظه پر باشه٬ باز سایت خیلی کندتر و حس سنگینی زیادی باز میشه. در نهایت ۳- خود این فرایند
نیاز به پردازش داره و ممکنه زمان‌بر باشه.</div></blockquote><div class="text">مرورگرها برای بهتر کردن این مسئله٬ کد هارو به صورت lazy پارس می‌کنن و ast ای تولید نمی‌کنن.
v8 علاوه بر این میاد میان کد رو pre-parse هم می‌کنه. </div><br/><br/><div class="text">توی <a href="/v8-parser" dir="ltr">قسمت بعدی</a> با جزئیات بیشتر به نحوه کار کردن parser و pre-parser می‌پردازیم.</div><div class="footnotes"><hr/><ol><li id="fn-1"><a href="https://v8.dev/blog/scanner">https://v8.dev/blog/scanner</a><a href="#fnref-1" class="footnote-backref">↩</a></li><li id="fn-2"><a href="https://v8.dev/blog/preparser">https://v8.dev/blog/preparser</a><a href="#fnref-2" class="footnote-backref">↩</a></li></ol></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/v8/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-d69664561c90ab43065f.js"],"app":["/app-fc6519f31c6e62d185e1.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-f320ba337d28ea2b66b6.js"],"component---src-pages-context-magic-mdx":["/component---src-pages-context-magic-mdx-7d815f0fda3b761b850a.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-f1114d5558dbd6ea36c1.js"],"component---src-pages-ratelimit-p-1-mdx":["/component---src-pages-ratelimit-p-1-mdx-e6a2f79308b17ab1af8e.js"],"component---src-pages-ratelimit-p-2-mdx":["/component---src-pages-ratelimit-p-2-mdx-d396b307766e78b1a114.js"],"component---src-pages-usb-switcher-mdx":["/component---src-pages-usb-switcher-mdx-3ae427c094674b038772.js"],"component---src-pages-v-8-ignition-mdx":["/component---src-pages-v-8-ignition-mdx-81a18377b88f88e9a629.js"],"component---src-pages-v-8-jit-mdx":["/component---src-pages-v-8-jit-mdx-524980411d4111a105cd.js"],"component---src-pages-v-8-mdx":["/component---src-pages-v-8-mdx-a3e700e62668fa47202f.js"],"component---src-pages-v-8-parser-mdx":["/component---src-pages-v-8-parser-mdx-2d45c7f76e544a018b51.js"]};/*]]>*/</script><script src="/polyfill-d69664561c90ab43065f.js" nomodule=""></script><script src="/component---src-pages-v-8-mdx-a3e700e62668fa47202f.js" async=""></script><script src="/b3cb720b120fadd5cd62c0f493389da7ab972379-9ace7c48e7e7a825d7a3.js" async=""></script><script src="/app-fc6519f31c6e62d185e1.js" async=""></script><script src="/framework-02d188296aa8e09a771c.js" async=""></script><script src="/webpack-runtime-eb92277a3bb70a1028db.js" async=""></script></body></html>